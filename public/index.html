<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>BrewSys :: Brewing Software</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <link rel="stylesheet" href="css/bootstrap.css">
        <style>
            body {
                padding-top: 60px;
                padding-bottom: 40px;
            }
        </style>


        <link rel="stylesheet" href="css/bootstrap-responsive.min.css">
        <link rel="stylesheet" href="css/custom-theme/jquery-ui-1.8.16.custom.css">
        
        <link rel="stylesheet" href="css/bml.css">

        
        <link rel="stylesheet" href="js/vendor/codemirror/lib/codemirror.css">
        <link rel="stylesheet" href="js/vendor/codemirror/lib/util/simple-hint.css">
        <link rel="stylesheet" href="css/main.css">

       
   
   

        <script src="js/vendor/modernizr-2.6.1-respond-1.1.0.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->

        <!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="#">BrewSys</a>
                    
                    <div class="nav-collapse collapse">
                        <ul class="nav">
                            <li class="active"><a href="#">Home</a></li>
                            <li><a href="#about">About</a></li>
                            <li><a href="#contact">Contact</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">

            <div class="row">
                <div class="recipe-editor span5">
                    <div class="section">
                        <textarea id="code" name="code">
--INFO-------------------------------------
style: 
brewers: 
size: 5 gallons

--GRAIN-------------------------------------
8 lbs American 2 row [1.8L 37PPG]

--HOPS--------------------------------------
60 min 3/4 oz Cascade [5%]

--YEAST-------------------------------------
1pkg Safeale US-05 [73%]

--NOTES-------------------------------------
Yummy!
                        </textarea>
                    </div>
                </div>
                <div class="beer-results span4"><div class="section content"></div></div>
                <div class="style-compare span3"><div class="section">foo</div></div>
            </div>


            <!-- Example row of columns -->
            <div class="row">
                <div class="span4">
                    <h4>Beer Markup</h4>
                    <p>
                        Beer Markup Language (BML).
                        A beer recipe syntax that is easy to write and read by humans yet has enough structure to be read by brewing software.
                    </p>
                    <p><a class="btn" href="https://github.com/frodare/beer-markup">View details &raquo;</a></p>
                </div>
                <div class="span4">
                    <h4>Beerd Brewing</h4>
                    <p>Beerd Brewing is a group of homebrewers mostly based in North Florida. Our mission is to make quality homebrewed beer and have fun educating people about brewing.</p>
                    <p>Follow us on <a href='https://www.facebook.com/beerdbrews'>Facebook</a> to see the latest creations.</p> 
                    <p><a class="btn" href="http://beerd.us">View details &raquo;</a></p>
                </div>
                <div class="span4">
                    <h4>jsBrewCalc</h4>
                    <p>JavaScript library of brewing calculations</p>
                    <p><a class="btn" href="https://github.com/frodare/jsBrewCalc">View details &raquo;</a></p>
               </div>
            </div>

            <hr>

            <footer>
                <p>&copy; Charles Howard 2012</p>
            </footer>

        </div> <!-- /container -->

        <script src="js/vendor/jquery-1.8.1.min.js"></script>
        <script src="js/vendor/jquery.tmpl.min.js"></script>
        <script src="js/vendor/jquery-ui-1.8.16.custom.min.js"></script>
        <script src="js/vendor/bootstrap.min.js"></script>


        <script src="js/vendor/codemirror/lib/codemirror.js"></script>
        <script src="js/vendor/codemirror/lib/util/simple-hint.js"></script>

        <script src="js/tables.js"></script>

        <script src="js/brewcalc.js"></script>
        <script src="js/brewcalc-gravity.js"></script>
        <script src="js/brewcalc-units.js"></script>
        
        <script src="js/main.js"></script>
        <script src="js/bml.js"></script>

        <script id="results-tmpl" type="text/x-jquery-tmpl">
            <div>
                <div><b>Total Grain</b>: ${stats.lbs}</div>
                <BR>
                <div><b>OG</b>: ${stats.og}</div>
                <div><b>FG</b>: ${stats.fg}</div>
                <div><b>IBU</b>: ${stats.ibu}</div>
                <div><b>SRM</b>: ${stats.srm}</div>
                <BR>
                <div><b>BU:GU</b>: ${stats.buog}</div>
                <div><b>ABV</b>: ${stats.abv}</div>
                <div><b>Calories/12oz</b>: ${stats.cal12oz}</div>
                <div style="height:20px;background-color:${color};"></div>
            </div>
        </script>

        <script>
            var display = $('.beer-results .content');
            $('#results-tmpl').template('results');
            
            /*
            $('#bml').bmlParser({
                update: function (ev, recipe) {
                    var stats = BREWCALC.compute(recipe);
                    
                    display.html($.tmpl('results', {
                        stats: stats,
                        color: BREWCALC.units.convert('SRM', 'HTML_RGB', stats.srm) 
                    }));

                }
            });*/


            CodeMirror.commands.autocomplete = function(e) {
                CodeMirror.simpleHint(e, CodeMirror.bmlHint);
            }


            var autoPatterns = {
                'grain' : /^[^\[]+$/,
                'hops' : /^[^\[]+$/
            }


            var editor;

            function parse() {
                var val = editor.getValue();
                var recipe = BML.parse(val);
                var stats = BREWCALC.compute(recipe);
                    
                display.html($.tmpl('results', {
                    stats: stats,
                    color: BREWCALC.units.convert('SRM', 'HTML_RGB', stats.srm) 
                }));
            }

            editor = CodeMirror.fromTextArea($('.recipe-editor textarea')[0], {
                mode: 'bml',
                lineNumbers: false,
                matchBrackets: true,
                theme: "default",
                onChange : function (cm, d) {
                    /* d  {from, to, text, next} */
                    var cursor = cm.getCursor()
                    var section = cm.getStateAfter(cursor.line).section;
                    var line = cm.getLine(cursor.line);

                    /*
                     * determine wether to auto fire or not
                     */
                    if (autoPatterns[section]) {
                        if(line && line.match(autoPatterns[section])){
                            CodeMirror.simpleHint(cm, CodeMirror.bmlHint);
                        }
                    }

                   
                    parse();
                },

                extraKeys: {"Ctrl-Space": "autocomplete"}
            });
            parse();

        </script>

    </body>
</html>
